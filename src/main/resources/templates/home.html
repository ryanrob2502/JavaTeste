<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Dashboard MÃ©dico - MedLink</title>
    <link rel="stylesheet" th:href="@{/css/home-styles.css?v=1.0}" />
    <link rel="icon" type="image/png" th:href="@{/img/favicon.png}"/>
    <script>
    (function() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            // Aplica a classe na tag <html>
            document.documentElement.classList.add('dark-mode');
        }
    })();
</script>
</head>
<body>
    <header>
        <nav class="nav-bar">
            <div class="logo">
                <h1>MedLink</h1> 
            </div>

            <div class="nav-list">
                <ul>
                    <li class="nav-item"><a th:href="@{/home}" class="nav-link active">Home</a></li>
                    <li class="nav-item"><a th:href="@{/pacientes}" class="nav-link">Pacientes</a></li>
                    <li class="nav-item"><a th:href="@{/consultas}" class="nav-link">Consultas</a></li>
                    <li class="nav-item"><a th:href="@{/configuracoes}" class="nav-link">ConfiguraÃ§Ãµes</a></li>
                </ul>
            </div>

            <div class="exit-button">
                <a th:href="@{/logout}" class="btn-sair">
                Sair
                </a>
            </div>

            <div class="mobile-menu-icon">
                <button id="mobile-menu-btn">
                    <svg class="icon" id="icon-menu" xmlns="http://www.w3.org/2000/svg" height="36px" viewBox="0 0 24 24" width="36px" fill="#FFFFFF">
                        <path d="M0 0h24v24H0V0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                    <svg class="icon" id="icon-close" style="display:none;" xmlns="http://www.w3.org/2000/svg" height="36px" viewBox="0 0 24 24" width="36px" fill="#FFFFFF">
                        <path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/>
                    </svg>
                </button>
            </div>
        </nav>

        <div class="mobile-menu" id="mobile-menu">
            <ul>
                <li class="nav-item"><a th:href="@{/home}" class="nav-link active">Home</a></li>
                <li class="nav-item"><a th:href="@{/pacientes}" class="nav-link">Pacientes</a></li>
                <li class="nav-item"><a th:href="@{/consultas}" class="nav-link">Consultas</a></li>
                <li class="nav-item"><a th:href="@{/configuracoes}" class="nav-link">ConfiguraÃ§Ãµes</a></li>
            </ul>
           <div class="exit-button-mobile">
            <a th:href="@{/logout}" class="btn-sair" onclick="">
                Sair
            </a>
        </div>
        </div>
    </header>

    <main class="dashboard">
        <!-- SeÃ§Ã£o do Perfil do MÃ©dico -->
        <section class="doctor-profile">
            <div class="profile-container">
                <form th:action="@{/perfil/foto}" method="post" enctype="multipart/form-data" class="photo-form">
                    <label for="fotoInput" class="photo-upload-label">
                            
                        <img th:if="${medico.getFotoPerfilBase64() != null}"
                                th:src="'data:image/jpeg;base64,' + ${medico.getFotoPerfilBase64()}"
                                alt="Foto do MÃ©dico" class="doctor-photo" />

                            <img th:if="${medico.getFotoPerfilBase64() == null}"
                                src="/img/medico-placeholder.jpg"
                                alt="Foto do MÃ©dico" class="doctor-photo" />

                        <div class="photo-overlay">
                            <span>Alterar Foto</span>
                        </div>
                    </label>
                    <input type="file" name="foto" id="fotoInput" hidden 
                           onchange="this.form.submit();" accept="image/png, image/jpeg">
                </form>
                
                <div class="doctor-info">
                    <h1 class="doctor-name" th:text="${medico != null ? 'Dr. ' + medico.nome : 'Dr. â€”'}">Dr. â€”</h1>
                    <p class="doctor-specialty" th:text="${(medico != null and !medico.especialidades.isEmpty()) ? #strings.listJoin(medico.especialidades.![nome], ', ') : 'Especialidade'}">
                        Especialidade
                     </p>
                </div>
            </div>
            
            <div th:if="${erroFoto}" class="photo-error">
                <span th:text="${erroFoto}"></span>
            </div>
        </section>

        <!-- SeÃ§Ã£o de EstatÃ­sticas -->
        <section class="stats-section">
            <div class="stats-card">
                <div class="stats-content">
                    <h3>Pacientes Ativos</h3>
                    <p class="stats-number" th:text="${totalPacientes != null ? totalPacientes : '0'}">0</p>
                </div>
                <div class="stats-icon">ðŸ‘¥</div>
            </div>
        </section>

        <!-- SeÃ§Ã£o de Gerenciamento -->
        <section class="management-section">
            <div class="section-header">
                <h2>Gerenciar Pacientes</h2>
                <div class="header-actions">
                    <form class="search-form" th:action="@{/pacientes}" method="get">
                        <div class="search-box">
                            <input type="text" name="q" placeholder="Buscar por nome ou CPF" class="search-input"/>
                            <button type="submit" class="search-btn">Buscar</button>
                        </div>
                    </form>
                    <button id="btn-toggle-form" class="add-patient-btn">
                        <span>+</span>
                        Adicionar Paciente
                    </button>
                </div>
            </div>

            <!-- FormulÃ¡rio de Adicionar Paciente -->
            <form id="form-adicionar" class="add-patient-form" th:action="@{/pacientes}" method="post" style="display: none;">
                <h3>Novo Paciente</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="nome" class="form-label">Nome Completo</label>
                        <input type="text" id="nome" name="nome" class="form-input" 
                            required 
                            pattern="[A-Za-zÃ€-Ãº\s]+" 
                            title="O nome deve conter apenas letras e espaÃ§os." />
                    </div>
                    
                    <div class="form-group">
                        <label for="idade" class="form-label">Idade</label>
                        <input type="number" id="idade" name="idade" min="0" class="form-input" />
                    </div>
                    
                    <div class="form-group">
                        <label for="cpf" class="form-label">CPF</label>
                        <input type="text" id="cpf" name="cpf" class="form-input" 
                            placeholder="000.000.000-00" 
                            pattern="\d{3}\.\d{3}\.\d{3}-\d{2}" 
                            title="Digite o CPF no formato 000.000.000-00" />
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="alergias" class="form-label">Alergias</label>
                        <input type="text" id="alergias" name="alergias" class="form-input" placeholder="ex: Penicilina, Amoxicilina" />
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="historicoCirurgias" class="form-label">Cirurgias Realizadas</label>
                        <input type="text" id="historicoCirurgias" name="historicoCirurgias" class="form-input" placeholder="ex: Apendicectomia (2018)" />
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="observacoes" class="form-label">ObservaÃ§Ãµes</label>
                        <textarea id="observacoes" name="observacoes" rows="3" class="form-textarea" placeholder="ObservaÃ§Ãµes adicionais sobre o paciente..."></textarea>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Salvar Paciente</button>
                    <button type="button" id="btn-cancel" class="btn btn-secondary">Cancelar</button>
                </div>
            </form>
        </section>
    </main>

    <script>
        
        const btnToggle = document.getElementById('btn-toggle-form');
        const formAdicionar = document.getElementById('form-adicionar');
        const btnCancel = document.getElementById('btn-cancel');

        btnToggle.addEventListener('click', () => {
            const isVisible = formAdicionar.style.display === 'block';
            formAdicionar.style.display = isVisible ? 'none' : 'block';
            
            if (!isVisible) {
                window.scrollTo({ 
                    top: formAdicionar.offsetTop - 20, 
                    behavior: 'smooth' 
                });
            }
        });

        btnCancel.addEventListener('click', () => {
            formAdicionar.style.display = 'none';
        });

        // MÃ¡scara para CPF
        const cpfInput = document.getElementById('cpf');
        if (cpfInput) {
            cpfInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length > 11) value = value.substring(0, 11);
                
                if (value.length > 9) {
                    value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
                } else if (value.length > 6) {
                    value = value.replace(/(\d{3})(\d{3})(\d{1,3})/, '$1.$2.$3');
                } else if (value.length > 3) {
                    value = value.replace(/(\d{3})(\d{1,3})/, '$1.$2');
                }
                e.target.value = value;
            });
        }

        // Mostrar mensagem de sucesso se existir
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('success')) {
            alert('Paciente cadastrado com sucesso!');
        }

        // Controle do menu mobile
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            const iconMenu = document.getElementById('icon-menu');
            const iconClose = document.getElementById('icon-close');
            
            if (mobileMenuBtn && mobileMenu) {
                mobileMenuBtn.addEventListener('click', function() {
                    const isOpen = mobileMenu.classList.toggle('open');
                    
                    // Alterna entre os Ã­cones de menu e fechar
                    if (isOpen) {
                        iconMenu.style.display = 'none';
                        iconClose.style.display = 'block';
                    } else {
                        iconMenu.style.display = 'block';
                        iconClose.style.display = 'none';
                    }
                });
            }
            
            // Fechar menu ao clicar em um link
            const mobileLinks = document.querySelectorAll('.mobile-menu .nav-link');
            mobileLinks.forEach(link => {
                link.addEventListener('click', () => {
                    mobileMenu.classList.remove('open');
                    iconMenu.style.display = 'block';
                    iconClose.style.display = 'none';
                });
            });
        });
    </script>
    
    <script th:src="@{/js/script.js}"></script>
</body>
</html>